!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs/operators"),require("rxjs"),require("@angular/core/testing")):"function"==typeof define&&define.amd?define("@ngxs/store",["exports","@angular/core","rxjs/operators","rxjs","@angular/core/testing"],e):e((t.ngxs=t.ngxs||{},t.ngxs.store={}),t.ng.core,t.rxjs.operators,t.rxjs,t.ng.core.testing)}(this,function(t,o,b,_,e){"use strict";var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function i(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var m=function(){return(m=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function O(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function n(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(u){o={error:u}}finally{try{r&&!r.done&&(n=i["return"])&&n.call(i)}finally{if(o)throw o.error}}return a}function w(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(n(arguments[e]));return t}var a=new o.InjectionToken("ROOT_STATE_TOKEN"),u=new o.InjectionToken("FEATURE_STATE_TOKEN"),A="NGXS_META",c="NGXS_SELECTOR_META",s=new o.InjectionToken("NGXS_PLUGINS"),p=function tt(){this.compatibility={strictContentSecurityPolicy:!1}};function h(t){if(!t.hasOwnProperty(A)){Object.defineProperty(t,A,{value:{name:null,actions:{},defaults:{},path:null,selectFromAppState:null,children:[],instance:null}})}return f(t)}function f(t){return t[A]}function l(t){if(!t.hasOwnProperty(c)){Object.defineProperty(t,c,{value:{selectFromAppState:null,originalFn:null,containerClass:null,selectorName:null}})}return y(t)}function y(t){return t[c]}function x(t,e){return e&&e.compatibility&&e.compatibility.strictContentSecurityPolicy?function n(t){var e=w(t);return function(t){return e.reduce(function(t,e){return t&&t[e]},t)}}(t):function a(t){for(var e=t,n="store."+e[0],r=0,o=e.length,i=n;++r<o;)i=i+" && "+(n=n+"."+e[r]);return new Function("store","return "+i+";")}(t)}function E(t){return t.constructor&&t.constructor.type?t.constructor.type:t.type}var d=function(t,e,r){t=m({},t);var n=e.split("."),o=n.length-1;return n.reduce(function(t,e,n){return t[e]=n===o?r:Array.isArray(t[e])?w(t[e]):m({},t[e]),t&&t[e]},t),t},g=function(t,e){return e.split(".").reduce(function(t,e){return t&&t[e]},t)};function j(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return v(t,"DISPATCHED")}function v(t,r){var o=function e(t){return t.reduce(function(t,e){return t[E(e)]=!0,t},{})}(t);return function(t){return t.pipe(function e(r,o){return b.filter(function(t){var e=E(t.action),n=r[e];return o?n&&t.status===o:n})}(o,r),function n(){return b.map(function(t){return t.action})}())}}function S(n){return function(t){return new _.Observable(function(e){return t.subscribe({next:function(t){n.run(function(){return e.next(t)})},error:function(t){n.run(function(){return e.error(t)})},complete:function(){n.run(function(){return e.complete()})}})})}}var P=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t._itemQueue=[],t._busyPushingNext=!1,t}return i(t,n),t.prototype.next=function(t){if(this._busyPushingNext)this._itemQueue.unshift(t);else{for(this._busyPushingNext=!0,n.prototype.next.call(this,t);0<this._itemQueue.length;){var e=this._itemQueue.pop();n.prototype.next.call(this,e)}this._busyPushingNext=!1}},t}(_.Subject),I=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.decorators=[{type:o.Injectable}],e}(P),R=function(e){function t(t,n){return e.call(this,function(e){t.pipe(S(n)).subscribe(function(t){return e.next(t)},function(t){return e.error(t)},function(){return e.complete()})})||this}return i(t,e),t.decorators=[{type:o.Injectable}],t.ctorParameters=function(){return[{type:I},{type:o.NgZone}]},t}(_.Observable),C=function(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return n.shift().apply(void 0,w(t,[function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return C(n).apply(void 0,w(t))}]))}},M=function(t){function e(){return t.call(this,{})||this}return i(e,t),e.decorators=[{type:o.Injectable}],e.ctorParameters=function(){return[]},e}(_.BehaviorSubject),N=function(){function t(t,e){this._parentManager=t,this._plugins=e,this.plugins=[],this.register()}return t.prototype.register=function(){var t;this._plugins&&(this.plugins=this._plugins.map(function(t){return t.handle?t.handle.bind(t):t}),this._parentManager&&(t=this._parentManager.plugins).push.apply(t,w(this.plugins)))},t.decorators=[{type:o.Injectable}],t.ctorParameters=function(){return[{type:t,decorators:[{type:o.Optional},{type:o.SkipSelf}]},{type:Array,decorators:[{type:o.Inject,args:[s]},{type:o.Optional}]}]},t}(),T=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.decorators=[{type:o.Injectable}],e}(_.Subject),D=function(){function t(t,e,n,r,o,i){this._errorHandler=t,this._actions=e,this._actionResults=n,this._pluginManager=r,this._stateStream=o,this._ngZone=i}return t.prototype.dispatch=function(t){var e=this,n=this._ngZone.runOutsideAngular(function(){return Array.isArray(t)?_.forkJoin(t.map(function(t){return e.dispatchSingle(t)})):e.dispatchSingle(t)});return n.subscribe({error:function(t){return e._ngZone.run(function(){return e._errorHandler.handleError(t)})}}),n.pipe(S(this._ngZone))},t.prototype.dispatchSingle=function(t){var r=this,o=this._stateStream.getValue(),e=this._pluginManager.plugins;return C(w(e,[function(t,e){t!==o&&r._stateStream.next(t);var n=r.getActionResultStream(e);return n.subscribe(function(t){return r._actions.next(t)}),r._actions.next({action:e,status:"DISPATCHED"}),r.createDispatchObservable(n)}]))(o,t).pipe(b.shareReplay())},t.prototype.getActionResultStream=function(e){return this._actionResults.pipe(b.filter(function(t){return t.action===e&&"DISPATCHED"!==t.status}),b.take(1),b.shareReplay())},t.prototype.createDispatchObservable=function(t){var e=this;return t.pipe(b.exhaustMap(function(t){switch(t.status){case"SUCCESSFUL":return _.of(e._stateStream.getValue());case"ERRORED":return _.throwError(t.error);default:return _.empty()}})).pipe(b.shareReplay())},t.decorators=[{type:o.Injectable}],t.ctorParameters=function(){return[{type:o.ErrorHandler},{type:I},{type:T},{type:N},{type:M},{type:o.NgZone}]},t}(),F=function(e){Object.freeze(e);var n="function"==typeof e,r=Object.prototype.hasOwnProperty;return Object.getOwnPropertyNames(e).forEach(function(t){!r.call(e,t)||n&&("caller"===t||"callee"===t||"arguments"===t)||null===e[t]||"object"!=typeof e[t]&&"function"!=typeof e[t]||Object.isFrozen(e[t])||F(e[t])}),e},k=function(){function t(t,e,n,r){this._stateStream=t,this._dispatcher=e,this._config=n,this._testBed=r,this.verifyDevMode()}return t.prototype.getRootStateOperations=function(){var e=this,t={getState:function(){return e._stateStream.getValue()},setState:function(t){return e._stateStream.next(t)},dispatch:function(t){return e._dispatcher.dispatch(t)}};return this._config.developmentMode?this.ensureStateAndActionsAreImmutable(t):t},t.prototype.verifyDevMode=function(){if(!(null!==this._testBed)){var t=this._config.developmentMode,e=o.isDevMode(),n=e&&!t,r="NgxsModule.forRoot(states, { developmentMode: !environment.production })";!e&&t?console.warn("Angular is running in production mode but NGXS is still running in the development mode!\n","Please set developmentMode to false on the NgxsModule options when in production mode.\n",r):n&&console.warn("RECOMMENDATION: Set developmentMode to true on the NgxsModule when Angular is running in development mode.\n",r)}},t.prototype.ensureStateAndActionsAreImmutable=function(n){return{getState:function(){return n.getState()},setState:function(t){var e=F(t);return n.setState(e)},dispatch:function(t){return n.dispatch(t)}}},t.decorators=[{type:o.Injectable}],t.ctorParameters=function(){return[{type:M},{type:D},{type:p},{type:e.TestBed,decorators:[{type:o.Optional}]}]},t}(),U=function(){function t(t){this._internalStateOperations=t}return t.prototype.createStateContext=function(u){var c=this._internalStateOperations.getRootStateOperations();return{getState:function(){var t=c.getState();return g(t,u.depth)},patchState:function(t){var e="object"!=typeof t;if(Array.isArray(t))throw new Error("Patching arrays is not supported.");if(e)throw new Error("Patching primitives is not supported.");var n=c.getState(),r=g(n,u.depth),o=m({},r);for(var i in t)o[i]=t[i];var a=d(n,u.depth,o);return c.setState(a),a},setState:function(t){var e=c.getState();return e=d(e,u.depth,t),c.setState(e),e},dispatch:function(t){return c.dispatch(t)}}},t.decorators=[{type:o.Injectable}],t.ctorParameters=function(){return[{type:k}]},t}(),Z=function(){function t(t,e,n,r,o,i){this._injector=t,this._config=e,this._parentFactory=n,this._actions=r,this._actionResults=o,this._stateContextFactory=i,this._states=[],this._connected=!1}return Object.defineProperty(t.prototype,"states",{get:function(){return this._parentFactory?this._parentFactory.states:this._states},enumerable:!0,configurable:!0}),t.prototype.add=function(t){var e,n,r,o,i=function y(n){var i=function(e){var t=n.find(function(t){return t===e});if(!t)throw new Error("Child state not found: "+e);if(!t[A])throw new Error("States must be decorated with @State() decorator");return t[A].name};return n.reduce(function(t,e){if(!e[A])throw new Error("States must be decorated with @State() decorator");var n=e[A],r=n.name,o=n.children;return t[r]=(o||[]).map(i),t},{})}(o=Array.isArray(t)?t:[t]),a=function d(t){var r=[],o={},i=function(e,n){void 0===n&&(n=[]),Array.isArray(n)||(n=[]),n.push(e),o[e]=!0,t[e].forEach(function(t){if(0<=n.indexOf(t))throw new Error("Circular dependency '"+t+"' is required by '"+e+"': "+n.join(" -> "));o[t]||i(t,n.slice(0))}),r.indexOf(e)<0&&r.push(e)};return Object.keys(t).forEach(function(t){return i(t)}),r.reverse()}(i),u=function g(t,e){void 0===e&&(e={});var o=function(t,e){for(var n in t)if(t.hasOwnProperty(n)&&0<=t[n].indexOf(e)){var r=o(t,n);return null!==r?r+"."+n:n}return null};for(var n in t)if(t.hasOwnProperty(n)){var r=o(t,n);e[n]=r?r+"."+n:n}return e}(i),c=function v(t){return t.reduce(function(t,e){if(!e[A])throw new Error("States must be decorated with @State() decorator");return t[e[A].name]=e,t},{})}(o),s=[],p=function(e){var t=c[e];if(!t[A])throw new Error("States must be decorated with @State() decorator");var n=u[e],r=t[A].actions,o=t[A].defaults;if(t[A].path=n,t[A].selectFromAppState=x(n.split("."),f._config),!f.states.find(function(t){return t.name===e})){Array.isArray(o)?o=w(o):!function a(t){return"object"==typeof t&&null!==t||"function"==typeof t}(o)?o===undefined&&(o={}):o=m({},o);var i=f._injector.get(t);s.push({actions:r,instance:i,defaults:o,name:e,depth:n})}},f=this;try{for(var l=O(a),h=l.next();!h.done;h=l.next()){p(h.value)}}catch(S){e={error:S}}finally{try{h&&!h.done&&(n=l["return"])&&n.call(l)}finally{if(e)throw e.error}}return(r=this.states).push.apply(r,w(s)),s},t.prototype.addAndReturnDefaults=function(t){if(t){var e=this.add(t);return{defaults:e.reduce(function(t,e){return d(t,e.depth,e.defaults)},{}),states:e}}},t.prototype.connectActionHandlers=function(){var n=this;this._connected||(this._actions.pipe(b.filter(function(t){return"DISPATCHED"===t.status}),b.mergeMap(function(t){var e=t.action;return n.invokeActions(n._actions,e).pipe(b.map(function(){return{action:e,status:"SUCCESSFUL"}}),b.defaultIfEmpty({action:e,status:"CANCELED"}),b.catchError(function(t){return _.of({action:e,status:"ERRORED",error:t})}))})).subscribe(function(t){return n._actionResults.next(t)}),this._connected=!0)},t.prototype.invokeInit=function(t){var e,n;try{for(var r=O(t),o=r.next();!o.done;o=r.next()){var i=o.value,a=i.instance;if(a.ngxsOnInit){var u=this.createStateContext(i);a.ngxsOnInit(u)}}}catch(c){e={error:c}}finally{try{o&&!o.done&&(n=r["return"])&&n.call(r)}finally{if(e)throw e.error}}},t.prototype.invokeActions=function(t,e){var n,r,o,i,a=[];try{for(var u=O(this.states),c=u.next();!c.done;c=u.next()){var s=c.value,p=E(e),f=s.actions[p];if(f)try{for(var l=O(f),h=l.next();!h.done;h=l.next()){var y=h.value,d=this.createStateContext(s);try{var g=s.instance[y.fn](d,e);g instanceof Promise&&(g=_.from(g)),g=g instanceof _.Observable?g.pipe(y.options.cancelUncompleted?b.takeUntil(t.pipe(j(e))):b.map(function(t){return t})):_.of({}).pipe(b.shareReplay()),a.push(g)}catch(v){a.push(_.throwError(v))}}}catch(S){o={error:S}}finally{try{h&&!h.done&&(i=l["return"])&&i.call(l)}finally{if(o)throw o.error}}}}catch(m){n={error:m}}finally{try{c&&!c.done&&(r=u["return"])&&r.call(u)}finally{if(n)throw n.error}}return a.length||a.push(_.of({})),_.forkJoin(a)},t.prototype.createStateContext=function(t){return this._stateContextFactory.createStateContext(t)},t.decorators=[{type:o.Injectable}],t.ctorParameters=function(){return[{type:o.Injector},{type:p},{type:t,decorators:[{type:o.Optional},{type:o.SkipSelf}]},{type:I},{type:T},{type:U}]},t}();function H(t,e){return t===e}function V(t,e){void 0===e&&(e=H);var n=null,r=null;function o(){return function i(t,e,n){if(null===e||null===n||e.length!==n.length)return!1;for(var r=e.length,o=0;o<r;o++)if(!t(e[o],n[o]))return!1;return!0}(e,n,arguments)||(r=t.apply(null,arguments)),n=arguments,r}return o.reset=function(){r=n=null},o}function L(o,r,t){var i=V(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=r.apply(void 0,w(t));return n instanceof Function?V.apply(null,[n]):n}),a=t&&t.containerClass,e=l(i);return e.originalFn=r,e.selectFromAppState=function(e){var t=[],n=[];a&&f(a)&&n.push(a);o&&n.push.apply(n,w(o)),n&&t.push.apply(t,w(n.map(function(t){return G(t)(e)})));try{return i.apply(void 0,w(t))}catch(r){if(r instanceof TypeError)return undefined;throw r}},t&&(e.containerClass=t.containerClass,e.selectorName=t.selectorName),i}function G(t){var e=y(t)||f(t);return e&&e.selectFromAppState||t}var q=function(){function t(t,e,n){this._ngZone=t,this._stateStream=e,this._internalStateOperations=n}return t.prototype.dispatch=function(t){return this._internalStateOperations.getRootStateOperations().dispatch(t)},t.prototype.select=function(t){var e=G(t);return this._stateStream.pipe(b.map(e),b.catchError(function(t){if(t instanceof TypeError)return _.of(undefined);throw t}),b.distinctUntilChanged(),S(this._ngZone))},t.prototype.selectOnce=function(t){return this.select(t).pipe(b.take(1))},t.prototype.selectSnapshot=function(t){return G(t)(this._stateStream.getValue())},t.prototype.subscribe=function(t){return this._stateStream.pipe(S(this._ngZone)).subscribe(t)},t.prototype.snapshot=function(){return this._internalStateOperations.getRootStateOperations().getState()},t.prototype.reset=function(t){return this._internalStateOperations.getRootStateOperations().setState(t)},t.decorators=[{type:o.Injectable}],t.ctorParameters=function(){return[{type:o.NgZone},{type:M},{type:k}]},t}(),X=function(){function n(t,e){n.store=t,n.config=e}return n.store=undefined,n.config=undefined,n.decorators=[{type:o.Injectable}],n.ctorParameters=function(){return[{type:q},{type:p}]},n}();var B=function(){function t(){}return Object.defineProperty(t,"type",{get:function(){return"@@INIT"},enumerable:!0,configurable:!0}),t}(),Q=function(){function t(){}return Object.defineProperty(t,"type",{get:function(){return"@@UPDATE_STATE"},enumerable:!0,configurable:!0}),t}(),z=function(){function t(t,e,n,r,o){var i=t.addAndReturnDefaults(o),a=e.getRootStateOperations();if(i){var u=a.getState();a.setState(m({},u,i.defaults))}t.connectActionHandlers(),a.dispatch(new B).subscribe(function(){i&&t.invokeInit(i.states)})}return t.decorators=[{type:o.NgModule}],t.ctorParameters=function(){return[{type:Z},{type:k},{type:q},{type:X},{type:Array,decorators:[{type:o.Optional},{type:o.Inject,args:[a]}]}]},t}(),J=function(){function t(t,e,n,r){var o=[].concat.apply([],w(r)),i=n.addAndReturnDefaults(o),a=e.getRootStateOperations();if(i){var u=a.getState();a.setState(m({},u,i.defaults))}a.dispatch(new Q).subscribe(function(){i&&n.invokeInit(i.states)})}return t.decorators=[{type:o.NgModule,args:[{}]}],t.ctorParameters=function(){return[{type:q},{type:k},{type:Z},{type:Array,decorators:[{type:o.Optional},{type:o.Inject,args:[u]}]}]},t}();function K(t){return Object.assign(new p,t)}var $=new o.InjectionToken("ROOT_OPTIONS"),Y=function(){function t(){}return t.forRoot=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e={}),{ngModule:z,providers:w([Z,U,R,I,D,T,k,q,M,X,N],t,[{provide:a,useValue:t},{provide:$,useValue:e},{provide:p,useFactory:K,deps:[$]}])}},t.forFeature=function(t){return{ngModule:J,providers:w([Z,N],t,[{provide:u,multi:!0,useValue:t}])}},t.decorators=[{type:o.NgModule,args:[{}]}],t}();var W=new RegExp("^[a-zA-Z0-9_]+$");t.NgxsModule=Y,t.Action=function et(f,l){return function(t,e,n){var r,o,i=h(t.constructor);Array.isArray(f)||(f=[f]);try{for(var a=O(f),u=a.next();!u.done;u=a.next()){var c=u.value,s=c.type;if(!c.type)throw new Error("Action "+c.name+' is missing a static "type" property');i.actions[s]||(i.actions[s]=[]),i.actions[s].push({fn:e,options:l||{},type:s})}}catch(p){r={error:p}}finally{try{u&&!u.done&&(o=a["return"])&&o.call(a)}finally{if(r)throw r.error}}}},t.Store=q,t.State=function nt(r){return function(t){var e=h(t);if(Object.getPrototypeOf(t).hasOwnProperty(A)){var n=Object.getPrototypeOf(t)[A];e.actions=m({},e.actions,n.actions)}if(e.children=r.children,e.defaults=r.defaults,e.name=r.name,!r.name)throw new Error("States must register a 'name' property");if(!W.test(r.name))throw new Error(r.name+" is not a valid state name. It needs to be a valid object property name.")}},t.Select=function rt(r){for(var o=[],t=1;t<arguments.length;t++)o[t-1]=arguments[t];return function(t,e){var n="__"+e+"__selector";if(r||(r=e.lastIndexOf("$")===e.length-1?e.substring(0,e.length-1):e),t[n])throw new Error("You cannot use @Select decorator and a "+n+" property.");delete t[e]&&(Object.defineProperty(t,n,{writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(t,e,{get:function(){return this[n]||(this[n]=function(t){var e=X.store;if(!e)throw new Error("SelectFactory not connected to store!");return e.select(t)}.apply(this,[(t=X.config,"string"!=typeof r?r[A]&&r[A].path?x(r[A].path.split("."),t):r:x(o.length?w([r],o):r.split("."),t))]));var t},enumerable:!0,configurable:!0}))}},t.Actions=R,t.getSelectorMetadata=y,t.getStoreMetadata=f,t.ensureStoreMetadata=h,t.ensureSelectorMetadata=l,t.ofAction=function ot(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return v(t)},t.ofActionDispatched=j,t.ofActionSuccessful=function it(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return v(t,"SUCCESSFUL")},t.ofActionCanceled=function at(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return v(t,"CANCELED")},t.ofActionErrored=function ut(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return v(t,"ERRORED")},t.Selector=function ct(i){return function(t,e,n){if(null===n.value)throw new Error("Selectors only work on methods");var r=n.value,o=L(i,r,{containerClass:t,selectorName:e});return{configurable:!0,get:function(){return o}}}},t.getActionTypeFromInstance=E,t.actionMatcher=function st(t){var e=E(t);return function(t){return e===E(t)}},t.createSelector=L,t.NGXS_PLUGINS=s,t.StateStream=M,t.setValue=d,t.getValue=g,t.InitState=B,t.UpdateState=Q,t.ɵg=I,t.ɵf=P,t.ɵe=X,t.ɵn=T,t.ɵo=D,t.ɵp=U,t.ɵm=Z,t.ɵq=k,t.ɵb=J,t.ɵa=z,t.ɵd=$,t.ɵc=K,t.ɵr=N,t.ɵi=u,t.ɵj=A,t.ɵl=p,t.ɵh=a,t.ɵk=c,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ngxs-store.umd.min.js.map